

Ansible-based e2e requires 
  
   a) Kubernetes cluster
   b) certain basic packages on the test machines 
   c) certain secrets/credentials to be available on the test harness (currently defined as ENV) 
   d) “Inventory” file 


**Packages**
 

   The test bed includes a “test harness” and the test Kubernetes cluster. The test harness acts as the “ansible control machine” and the cluster nodes as the “remote hosts”. 

   All the test boxes need : 

    - Basic development packages (dpkg-dev, gcc, g++, libc6-dev, make, libssl-dev, sshpass, curl) 
    - OpenSSH services running
    - Python installed (& configured w/ right path) 

   The control node needs,

    - Ansible (installed as a Python package via pip OR via the OS package managers)


At times, the test harness can double up to perform the role of the Kubernetes control node, provided the kubeconfig files are available. This is the case when executing e2e on managed-kubernetes providers such as GKE.


**Credentials**
 
      The e2e tests perform certain actions on the Kubernetes master/control node and the minions/hosts, which need the host credentials to be available, either to be used at runtime or to setup passwordless SSH amongst the ansible control/harness machines and the target hosts. 

      Currently, these can be setup as ENV in the harness machine ansible user’s profile.
    


    ```
      export LOCAL_USER_NAME="<Test harness user name>"
      export LOCAL_USER_PASSWORD="<Test harness password>"
      export USER_NAME="<K8s Master user name>"
      export USER_PASSWORD="<K8s Master password>"
      export MACHINES_USER_NAME="<K8s node user name>"
      export MACHINES_USER_PASSWORD="<K8s node password>"
      export SLACK_TOKEN="<Slack token>"
      export ZONE="<Zone where the cluster was created>"
    ```

     After adding the above details into the ~/.profile file, source it.
    


**Ansible Inventory**

       The OpenEBS e2e directory structure follows the standard practices recommended by the Ansible community and maintains the global variables definition at inventory/group_vars/all.yaml  & the inventory (hosts) file at inventory/hosts. This file is generated by running a “pre-requisites” playbook which in turn invokes an “inventory” role to generate this file from a template containing details of the test harness and target hosts. 

       
       ```
         cd openebs/e2e/ansible

         ansible-playbook pre-requisites.yml
       ```


      Now, the test bed is ready to run ansible-playbooks in your environment.









         
