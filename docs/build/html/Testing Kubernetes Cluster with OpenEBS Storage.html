
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Testing Kubernetes Cluster with OpenEBS Storage &#8212; OpenEBS 0.0.2 documentation</title>
    
    <link rel="stylesheet" href="_static/agogo.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.0.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Setting up Kubernetes and OpenEBS Clusters" href="Setting up Kubernetes and OpenEBS Clusters.html" /> 
  </head>
  <body role="document">
    <div class="header-wrapper" role="banner">
      <div class="header">
        <div class="headertitle"><a
          href="index.html">OpenEBS 0.0.2 documentation</a></div>
        <div class="rel" role="navigation" aria-label="related navigation">
          <a href="Setting up Kubernetes and OpenEBS Clusters.html" title="Setting up Kubernetes and OpenEBS Clusters"
             accesskey="P">previous</a> |
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a>
        </div>
       </div>
    </div>

    <div class="content-wrapper">
      <div class="content">
        <div class="document">
            
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="testing-kubernetes-cluster-with-openebs-storage">
<span id="getting-started"></span><h1>Testing Kubernetes Cluster with OpenEBS Storage<a class="headerlink" href="#testing-kubernetes-cluster-with-openebs-storage" title="Permalink to this headline">¶</a></h1>
<div class="section" id="kubernetes-and-openebs-clusters-on-ubuntu-16-04">
<span id="installing-docdir"></span><h2>Kubernetes and OpenEBS Clusters on Ubuntu 16.04<a class="headerlink" href="#kubernetes-and-openebs-clusters-on-ubuntu-16-04" title="Permalink to this headline">¶</a></h2>
<p>In this example, we will start running fio pod (fio-tests) with OpenEBS Storage.</p>
</div>
<div class="section" id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<p>Verify that your Kubernetes and OpenEBS Cluster machines are up and running:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>ubuntu-host:~/$ vagrant status
Current machine states:

kubemaster-01             running (virtualbox)
kubeminion-01             running (virtualbox)
omm-01                    running (virtualbox)
osh-01                    running (virtualbox)
osh-02                    running (virtualbox)
</pre></div>
</div>
<p>Verify the status of the Kubernetes Nodes:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>ubuntu-host:~/$ vagrant ssh kubemaster-01
ubuntu@kubemaster-01:~$ kubectl get nodes
NAME            STATUS         AGE
kubemaster-01   Ready,master   56m
kubeminion-01   Ready          51m
ubuntu@kubemaster-01:~$

ubuntu@kubemaster-01:~$ kubectl get pods --all-namespaces
NAMESPACE     NAME                                    READY     STATUS    RESTARTS   AGE
kube-system   dummy-2088944543-9m94d                  1/1       Running   0          56m
kube-system   etcd-kubemaster-01                      1/1       Running   0          55m
kube-system   kube-apiserver-kubemaster-01            1/1       Running   0          56m
kube-system   kube-controller-manager-kubemaster-01   1/1       Running   0          55m
kube-system   kube-discovery-1769846148-sstmc         1/1       Running   0          56m
kube-system   kube-dns-2924299975-s779z               4/4       Running   0          56m
kube-system   kube-proxy-40xr6                        1/1       Running   0          52m
kube-system   kube-proxy-k7x46                        1/1       Running   0          55m
kube-system   kube-scheduler-kubemaster-01            1/1       Running   0          56m
kube-system   weave-net-2qw1g                         2/2       Running   0          55m
kube-system   weave-net-c577k                         2/2       Running   0          52m
ubuntu@kubemaster-01:~$
</pre></div>
</div>
<p>Verify the status of the OpenEBS Nodes:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>ubuntu-host:~/$ vagrant ssh omm-01
..snipped...
ubuntu@omm-01:~$ maya omm-status
Name           Address       Port  Status  Leader  Protocol  Build  Datacenter  Region
omm-01.global  172.28.128.4  4648  alive   true    2         0.5.5  dc1         global

m-apiserver listening at http://172.28.128.4:5656
ubuntu@omm-01:~$ maya osh-status
ID        DC   Name    Class   Drain  Status
e57020e9  dc1  osh-02  &lt;none&gt;  false  ready
b6789013  dc1  osh-01  &lt;none&gt;  false  ready
ubuntu@omm-01:~$
</pre></div>
</div>
<p>Note the m-apiserver listening URL. You will need to provide this in the vdbench pod yaml spec.</p>
</div>
<div class="section" id="configure-the-k8s-vdbench-pod-to-use-the-openebs-volume">
<h2>Configure the K8s VDbench Pod to use the OpenEBS Volume<a class="headerlink" href="#configure-the-k8s-vdbench-pod-to-use-the-openebs-volume" title="Permalink to this headline">¶</a></h2>
<p>To configure run the following:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>ubuntu-host:~/$ vagrant ssh kubemaster-01
ubuntu@kubemaster-01:~$ cd demo/k8s/spec/
ubuntu@kubemaster-01:~/demo/k8s/spec$ cat demo-fio-openebs-plugin.yaml
---
apiVersion: v1
kind: Pod
metadata:
  name: tests-fio
  labels:
    name: tests-fio
spec:
  containers:
  - resources:
      limits:
        cpu: 0.5
    name: tests-fio
    image: openebs/tests-fio
    command: [&quot;/fio_runner.sh&quot;]
    args: [&quot;Basic&quot;, &quot;600&quot;]
    tty: true
    volumeMounts:
    - mountPath: /datadir1
      name: demo-vsm1-vol1
  volumes:
  - name: demo-vsm1-vol1
    flexVolume:
      driver: &quot;openebs/openebs-iscsi&quot;
      options:
        name: &quot;demo-vsm1-vol1&quot;
        openebsApiUrl: &quot;http://172.28.128.4:5656/latest&quot;
        size: &quot;2G&quot;
</pre></div>
</div>
<p>The yaml ships with an default address for the openebsApiUrl. Modify this with the correct address, noted in the previous step.</p>
<p>Start the fio pod:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>ubuntu@kubemaster-01:~/demo/k8s/spec$ kubectl create -f demo-fio-openebs-plugin.yaml
pod &quot;tests-fio&quot; created
ubuntu@kubemaster-01:~/demo/k8s/spec$

ubuntu@kubemaster-01:~/demo/k8s/spec$ kubectl get pods
NAME        READY     STATUS              RESTARTS   AGE
tests-fio   0/1       ContainerCreating   0          4s
ubuntu@kubemaster-01:~/demo/k8s/spec$
</pre></div>
</div>
<p>Once the volume is mounted and database is initialized, the pod status turns to running. When the first volume is launched, the openebs volume images are downloaded and there may be a bit of delay due to slow network:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>ubuntu@kubemaster-01:~$ kubectl get pods
NAME           READY     STATUS    RESTARTS   AGE
tests-fio   1/1       Running   0          9m
ubuntu@kubemaster-01:~$
</pre></div>
</div>
<p>You can check on the output by running the following command:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>ubuntu@kubemaster-01:~$ kubectl logs -f tests-fio
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
        </div>
        <div class="sidebar">
          <h3>Table Of Contents</h3>
          <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="Setting up Kubernetes and OpenEBS Clusters.html">Setting up Kubernetes and OpenEBS Clusters</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Testing Kubernetes Cluster with OpenEBS Storage</a></li>
</ul>

          <div role="search">
            <h3 style="margin-top: 1.5em;">Search</h3>
            <form class="search" action="search.html" method="get">
                <input type="text" name="q" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
            </form>
          </div>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

    <div class="footer-wrapper">
      <div class="footer">
        <div class="left">
          <div role="navigation" aria-label="related navigaton">
            <a href="Setting up Kubernetes and OpenEBS Clusters.html" title="Setting up Kubernetes and OpenEBS Clusters"
              >previous</a> |
            <a href="genindex.html" title="General Index"
              >index</a>
          </div>
          <div role="note" aria-label="source link">
              <br/>
              <a href="_sources/Testing Kubernetes Cluster with OpenEBS Storage.rst.txt"
                rel="nofollow">Show Source</a>
          </div>
        </div>

        <div class="right">
          
    <div class="footer" role="contentinfo">
        &#169; Copyright 2016 - 2017, CloudByte Inc.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.5.2.
    </div>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

  </body>
</html>